{% extends 'dash-base.html' %}
<!-- COMIENZA CONTENIDO DEL MENU -->
{% load static %}

{% block encabezado %}
<style>
  body {

    background-color: #eee;
  }

  .card {

    background-color: #fff;
    padding: 15px;
    border: none;
  }

  /* .input-box {
    position: relative;
  }

  .input-box i {
    position: absolute;
    right: 13px;
    top: 15px;
    color: #ced4da;

  } */

  /* .form-control {

    height: 50px;
    background-color: #eeeeee69;
  } */

  /* .form-control:focus {
    background-color: #eeeeee69;
    box-shadow: none;
    border-color: #eee;
  } */


  .list {

    padding-top: 20px;
    padding-bottom: 10px;
    display: flex;
    align-items: center;

  }

  .border-bottom {

    border-bottom: 2px solid #eee;
  }

  .list i {
    font-size: 19px;
    color: red;
  }

  .list small {

    color: grey;
  }
</style>
{% endblock encabezado %}


{% block contenido %}

<div class="text">ALTA DE MASCOTAS</div>

{% if mensaje %}
<div class="alert alert-success" role="alert">
  {{ mensaje }}
</div>
{% endif %}

{% if error %}
<div class="alert alert-danger" role="alert">
  {{ error }}
</div>
{% endif %}

{{ form.errors }}
<form method="POST" action="{% url 'mascotas:carga' %}">
  {% csrf_token %}
  <div class="form-group card ">
    <div class="form-group">
      <label for="dni">DNI del Usuario Propietario:</label>
      <input type="text" class="form-control" id="dni" name="dni" placeholder="Ingrese el DNI del usuario">
    </div>

  </div>
  <div class="form-group">
    <label for="nombre">Nombre de la mascota:</label>
    <input {% if form.nombre.value %} value="{{form.nombre.value}}" {% endif %} type="text" class="form-control"
      id="nombre" name="nombre" placeholder="Ingrese el nombre de la mascota">
  </div>
  <div class="form-group">
    <label for="microchip">Microchip:</label>
    <input {% if form.micro_chip.value %} value="{{form.micro_chip.value}}" {% endif %} " type=" text"
      class="form-control" id="microchip" name="micro_chip" placeholder="Ingrese el número de microchip">
  </div>
  <div class="form-group">
    <label for="especie">Especie:</label>
    <input {% if form.especie.value %} value="{{form.especie.value}}" {% endif %}" type="text" class="form-control"
      id="especie" name="especie" placeholder="Ingrese la especie de la mascota">
  </div>
  <div class="form-group">
    <label for="raza">Raza:</label>
    <input {% if form.raza.value %} value="{{form.raza.value}}" {% endif %}" type="text" class="form-control" id="raza"
      name="raza" placeholder="Ingrese la raza de la mascota">
  </div>
  <div class="form-group">
    <label for="pelaje">Pelaje:</label>
    <input {% if form.pelaje.value %} value="{{form.pelaje.value}}" {% endif %} type="text" class="form-control"
      id="pelaje" name="pelaje" placeholder="Ingrese el pelaje de la mascota">
  </div>
  <div class="form-group">
    <label for="fecha-nacimiento">Fecha de nacimiento:</label>
    <input value="
    {% if form.fecha_nacimiento.value %}
    value=" {{form.fecha_nacimiento.value}}" {% endif %}" type="date" class="form-control" id="fecha_nacimiento"
      name="fecha_nacimiento">
  </div>
  <div class="form-group">
    <label for="plan">Tipo de Plan:</label>
    <input {% if form.pelaje.value %} value="{{form.pelaje.value}}" {% endif %}" type="text" class="form-control"
      id="plan" name="tipo_plan" placeholder="Ingrese el tipo de Plan">
  </div>

  <button type="submit" class="btn btn-primary">Agregar mascota</button>
</form>

<div class="input-group mb-3">
  <input id="id_mascota_buscada" type="text" class="form-control" placeholder="Ingrese el Microchip de la mascota">
  <div class="input-group-append">
    <button id="btn_buscar_mascota" class="btn btn-outline-secondary" type="button">Buscar</button>
  </div>
</div>

<table class="table">
  <thead>
    <tr>
      <th>Nombre</th>
      <th>Microchip</th>
      <th>Especie</th>
      <th>Raza</th>
      <th>Pelaje</th>
      <th>Edad</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody id="busqueda_mascotas">


  </tbody>
</table>


<script>
  $(document).ready(function () {
    $('#dni').keyup(function () {
      $('.list').remove()
      $('.results').remove()
      var query = $(this).val();
      if (query.length >= 3) {
        $.ajax({
          url: `/usuarios/json_buscar_usuario/${query}`,
          dataType: 'json',
          success: function (data) {
            data.forEach(element => {
              var line = $('<div>').addClass("list border-bottom mb-2")
              var div = $('<div>').addClass('d-flex align-items-center results');
              var i = $('<i>').addClass('fas fa-users');
              var div2 = $('<div>').addClass('d-flex flex-column ml-3');
              var span = $('<span>').text(`${element.nombre} ${element.apellido}`);
              var small = $('<small>').text(`${element.dni}`);

              div.append(i);
              div2.append(span, small);
              div.append(div2);
              // Ahora puedes agregar el elemento a algún contenedor en tu página, por ejemplo:
              $('.card').append(line);
              $('.card').append(div);
            });

            $('.results').click(function () {
              var dni = $(this).find('small').text();
              $('#dni').val(dni);
              $('.list').remove()
              $('.results').remove()
            });
          }
        });
      }
    });


    $('#btn_buscar_mascota').click(function () {
      console.log('click')
      let fila = ''
      $('#busqueda_mascotas').empty()
      var query = $('#id_mascota_buscada').val();
      if (query.length >= 3) {
        $.ajax({
          url: `/mascotas/json_buscar_mascota/${query}`,
          dataType: 'json',
          success: function (data) {
            data.forEach(element => {
              fila = `<tr >\
                          <td>${element.nombre}</td>\
                          <td>${element.micro_chip}</td>\
                          <td>${element.especie}</td>\
                          <td>${element.raza}</td>\
                          <td>${element.pelaje}</td>\
                          <td>${element.edad}</td>\
                          <td>\
                            <a href="#" class="btn btn-outline-primary btn-sm">Editar</a>\
                            <a class="btn btn-outline-danger btn-sm eliminar-mascota" href="/mascotas/${element.id}/borrar/" data-confirm="Vas a eliminiar ${element.nombre}" >Eliminar</a>\
                          </td>
                        </tr>`
              document.getElementById('busqueda_mascotas').innerHTML += fila;
            });
            new jBox('Confirm', {
              confirmButton: 'Eliminar',
              cancelButton: 'No'
            });
          }
        });
      }
    });


    // $('#busqueda_mascotas').on('click', '.eliminar-mascota', function () {
    //   console.log('click');
    //   // aquí puedes agregar el código para mostrar el modal de confirmación y realizar la eliminación de la mascota si el usuario confirma.
    // });
  });


</script>
{% endblock contenido %}